# Redis Commands for User Presence Management using Bitmaps

# Set user presence (online/offline)
# BITFIELD allows us to treat Redis strings as arrays of bits
BITFIELD presence_bitmap SET u1 #user_id 1    # Set user as online
BITFIELD presence_bitmap SET u1 #user_id 0    # Set user as offline

# Get user presence
BITFIELD presence_bitmap GET u1 #user_id      # Get user presence (1 = online, 0 = offline)

# Get all online users (in batches of 8 users)
BITCOUNT presence_bitmap                        # Count total online users
BITPOS presence_bitmap 1                        # Find first online user
BITPOS presence_bitmap 1 start_position         # Find next online user

# Batch operations for presence updates
MULTI
BITFIELD presence_bitmap SET u1 #user1_id 1
BITFIELD presence_bitmap SET u1 #user2_id 1
BITFIELD presence_bitmap SET u1 #user3_id 1
EXEC

# Expire presence bitmap after a certain time (e.g., 30 minutes)
EXPIRE presence_bitmap 1800

# Session-based presence management
SET session:#session_id #user_id EX 1800       # Store user session with expiration
GET session:#session_id                         # Get user ID from session
DEL session:#session_id                         # Remove session on logout

# Room/Group presence tracking
SADD room:#room_id #user_id                     # Add user to room
SREM room:#room_id #user_id                     # Remove user from room
SMEMBERS room:#room_id                          # Get all users in room
SCARD room:#room_id                             # Count users in room